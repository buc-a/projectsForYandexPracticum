(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),e.querySelector(".popup__close").addEventListener("click",(function(){t(e)})),document.addEventListener("keydown",n),e.addEventListener("mouseup",(function(n){e.querySelector(".popup__content").contains(n.target)||t(e)}))}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}var o=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""},r=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_inactive"):t.classList.add("popup__button_inactive")},c=function(e){var t=Array.from(e.querySelectorAll(".popup__input"));t.forEach((function(t){o(e,t)}));var n=e.querySelector(".popup__button");r(t,n)},u="https://nomoreparties.co/v1/frontend-st-cohort-201",i="474d755c-7404-400b-a7a9-c788ccd1f694",a=document.querySelector("#card-template"),p=document.querySelector(".popup_type_image");function s(t,n,o,r,c,s){var l=a.content.cloneNode(!0),d=l.querySelector(".card__image"),_=l.querySelector(".card__title"),f=l.querySelector(".card__like-button"),y=l.querySelector(".card__like-number"),v=l.querySelector(".card__delete-button");return r||v.classList.add("card__delete-button_invisible"),c&&f.classList.add("card__like-button_is-active"),d.src=n,d.alt=t,_.textContent=t,y.textContent=o,f.addEventListener("click",(function(){f.classList.toggle("card__like-button_is-active"),f.classList.contains("card__like-button_is-active")?function(e){return fetch(u+"/cards/likes/"+e,{method:"PUT",headers:{authorization:i,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(s).then((function(e){return y.textContent=e.likes.length})).catch((function(e){return console.log("Error in button-like: "+e)})):function(e){return fetch(u+"/cards/likes/"+e,{method:"DELETE",headers:{authorization:i,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(s).then((function(e){return y.textContent=e.likes.length})).catch((function(e){return console.log("Error in button-like: "+e)}))})),v.addEventListener("click",(function(){(function(e){return fetch(u+"/cards/"+e,{method:"DELETE",headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(s).catch((function(e){console.log("Delete card error: "+e)})),v.closest(".card").remove()})),d.addEventListener("click",(function(){var o=p.querySelector(".popup__caption");p.querySelector(".popup__image").src=n,o.textContent=t,e(p)})),l}var l,d=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),f=document.querySelector(".profile__image"),y=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_new-avatar"),q=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__avatar-container"),L=S.querySelector(".popup__form"),b=L.querySelector(".popup__input_type_url"),C=L.querySelector(".popup__button"),g=v.querySelector(".popup__form"),j=g.querySelector(".popup__input_type_name"),x=g.querySelector(".popup__input_type_description"),P=g.querySelector(".popup__button"),T=m.querySelector(".popup__form"),z=T.querySelector(".popup__input_type_card-name"),A=T.querySelector(".popup__input_type_url"),D=T.querySelector(".popup__button");v.classList.add("popup_is-animated"),m.classList.add("popup_is-animated"),h.classList.add("popup_is-animated"),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=e.querySelector(".popup__button");e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll(".popup__input"));n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t){t.validity.valid?o(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input-error_active")}(e,t,t.validationMessage)}(e,c),r(n,t)}))}))}(e)})),fetch(u+"/users/me",{headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){l=e._id,d.textContent=e.name,_.textContent=e.about,f.src=e.avatar,fetch(u+"/cards",{headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=0;e.likes.forEach((function(e){e._id==l&&(t=1)}));var n=s(e.name,e.link,e.likes.length,e.owner._id==l,t,e._id);y.append(n)}))})).catch((function(e){console.log("Error: "+e)}))})).catch((function(e){console.log("Error: "+e)})),k.addEventListener("click",(function(){b.value="",e(S);var t=S.querySelector(".popup__form");c(t)})),L.addEventListener("submit",(function(e){e.preventDefault(),C.textContent="Сохранение...";var n,o=b.value;(n=o,fetch(u+"/users/me/avatar",{method:"PATCH",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){f.src=o})).catch((function(e){console.log("Error in edit avatar: "+e)})).finally((function(){C.textContent="Сохранить",t(S)}))})),q.addEventListener("click",(function(){j.value=d.textContent,x.value=_.textContent,e(v);var t=v.querySelector(".popup__form");c(t)})),g.addEventListener("submit",(function(e){var n,o;e.preventDefault(),P.textContent="Сохранение...",(n=j.value,o=x.value,fetch(u+"/users/me",{method:"PATCH",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){d.textContent=j.value,_.textContent=x.value})).catch((function(e){console.log("Error in set user info : "+e)})).finally((function(){P.textContent="Сохранение...",t(v)}))})),E.addEventListener("click",(function(){z.value="",A.value="",e(m);var t=m.querySelector(".popup__form");c(t)})),T.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=z.value,c=A.value;D.textContent="Сохранение...",(n=r,o=c,fetch(u+"/cards",{method:"POST",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=s(r,c);y.prepend(t)})).catch((function(e){console.log("Error in added card: "+e)})).finally((function(){D.textContent="Сохранить",t(m)}))}))})();